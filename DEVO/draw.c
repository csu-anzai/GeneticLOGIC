/*
#define FRAME_CHECK
#define DEBUG
#define THING_CHECK
#define INTEGRITY_CHECK
#define UNLINK_DEBUG
*/

/*
This code is MINE MINE MINE!
If you would like to use it, then AT LEAST leave this header on it!
A donation for whatever it's worth to you would be greatly appreciated.
NOT for resale unless otherwise arranged for with myself.
Private use only.

	Richard H. Clark
	14550 Triadelphia Rd.
	Glenelg, MD 21737

*/


#ifdef THING_CHECK
	struct thing *thing_check();
	#define THINGS(p,s)	thing_check((p),s)
#else
	#define THINGS(p,s)	things[(p)]
#endif
/*

Some draw routines

*/
#include <stdio.h>
#include <time.h>
#include <stdlib.h>
#include <graph.h>

#include "devospac.h"


clp(ix,iy)
int ix,iy;
{
register char far *the_screen;
register int i;

	the_screen = 0xA0000000L;
	the_screen = the_screen + ((long)iy*80) + (long)ix/8;

/*
Write mode 2... replace... update all bits...
*/
	outpw(0x3ce,0xff08);
	outpw(0x3ce,0x0205);
	outpw(0x3ce,0x0003);

	for(i=0;i<CHARY;i++){
		*the_screen = 0x00;
		the_screen += 80;
	}
	outpw(0x3ce,0xff08);
	outpw(0x3ce,0x0005);
	outpw(0x3ce,0x0003);
}

dr_energy()
{
static char c_energy[16] = { 0x00,0x00,0x00,
			     0x00,0x00,0x00,
			     0x18,0x3c,0x18,
			     0x00,0x00,0x00,
			     0x00,0x00,0x00,0x00 };
	draw_it(c_energy,14);
}

dr_cursor(ix,iy)
int ix,iy;
{
static char c_cursor[16] = { 0xff,0xff,0xff,
			     0xff,0xff,0xff,
			     0xff,0xff,0xff,
			     0xff,0xff,0xff,
			     0xff,0xff,0xff,0xff };
	xx = ix;
	yy = iy;
	draw_it(c_cursor,15);
}

print_block(ix,iy,btype)
int ix,iy,btype;
{
static char p_block[16] = { 0xff,0xff,0xff,
			     0xff,0xff,0xff,
			     0xff,0xff,0xff,
			     0xff,0xff,0xff,
			     0xff,0xff,0xff,0xff };
	xx = ix;
	yy = iy;
	if(btype == -3)
		draw_it(p_block,10);
	else
		draw_it(p_block,14);
}

dr_double()
{
#if SCREEN_MODE == _VRES16COLOR
static char c_double[16] = { 0x00,0x18,0x3c,
			     0x7e,0x7e,0x7e,0x3c,
			     0x18,
			     0x18,0x3c,0x7e,0x7e,
			     0x7e,0x3c,0x18,0x00 };
static char c_double_s[16] = { 0x00,0x18,0x24,
			     0x42,0x42,0x42,0x24,
			     0x18,
			     0x00,0x00,0x00,0x00,
			     0x00,0x00,0x00,0x00 };
static char c_double_d[16] = { 0x00,0x18,0x24,
			     0x42,0x42,0x42,0x24,
			     0x18,
			     0x18,0x24,0x42,0x42,
			     0x42,0x24,0x18,0x00 };
#else
static char c_double[12] = { 0x00,0x18,0x3c,
			     0x7e,0x3c,
			     0x18,
			     0x18,0x3c,0x7e,
			     0x3c,0x18,0x00 };
static char c_double_s[12] = { 0x00,0x18,0x24,
			     0x42,0x24,
			     0x18,
			     0x00,0x00,0x00,
			     0x00,0x00,0x00 };
static char c_double_d[12] = { 0x00,0x18,0x24,
			     0x42,0x24,
			     0x18,
			     0x18,0x24,0x42,
			     0x24,0x18,0x00 };
#endif
	draw_it(c_double,2);
	if(ee)
		if(ee < 2)
			draw_it(c_double_s,13);
		else
			draw_it(c_double_d,13);
}

dr_single()
{
#if SCREEN_MODE == _VRES16COLOR
static char c_single[16] = { 0x00,0x18,0x3c,
			     0x7e,0x7e,0x7e,0x7e,
			     0x7e,0x7e,0x7e,0x7e,
			     0x3c,0x18,0x00,0x00,0x00 };
static char c_single_e[16] = { 0x00,0x18,0x24,
			     0x42,0x42,0x42,0x42,
			     0x42,0x42,0x42,0x42,
			     0x24,0x18,0x00,0x00,0x00 };
#else
static char c_single[12] = { 0x00,0x18,0x3c,
			     0x7e,0x7e,
			     0x7e,0x7e,0x7e,
			     0x3c,0x18,0x00,0x00 };
static char c_single_e[12] = { 0x00,0x18,0x24,
			     0x42,0x42,
			     0x42,0x42,0x42,
			     0x24,0x18,0x00,0x00 };
#endif
	draw_it(c_single,3);
	if(ee)
		draw_it(c_single_e,12);
}

dr_move()
{
#if SCREEN_MODE == _VRES16COLOR
static char c_move[16] = { 0x00,0x00,0x00,
			     0x00,0xe7,0xc3,0xa5,
			     0x18,0x18,0xa5,0xc3,
			     0xe7,0x00,0x00,0x00,0x00 };
#else
static char c_move[12] = { 0x00,0x00,0xe7,
			     0xc3,0xa5,
			     0x18,0x18,0xa5,
			     0xc3,0xe7,0x00,0x00 };
#endif
	draw_it(c_move,4);
}

dr_repo()
{
#if SCREEN_MODE == _VRES16COLOR
static char c_repo[16] = { 0xff,0x81,0x81,
			     0x81,0x81,0x81,0x81,
			     0x81,0x81,0x81,0x81,
			     0x81,0x81,0x81,0x81,0xff };
static char c_repo_10[16] = { 0x00,0x24,0x7e,
			     0x7e,0x24,0x00,0x24,
			     0x7e,0x7e,0x24,0x00,
			     0x24,0x7e,0x7e,0x24,0x00 };
static char c_repo_8[16] = { 0x00,0x24,0x7e,
			     0x7e,0x24,0x00,0x24,
			     0x7e,0x7e,0x24,0x00,
			     0x20,0x70,0x70,0x20,0x00 };
static char c_repo_6[16] = { 0x00,0x24,0x7e,
			     0x7e,0x24,0x00,0x24,
			     0x7e,0x7e,0x24,0x00,
			     0x00,0x00,0x00,0x00,0x00 };
static char c_repo_4[16] = { 0x00,0x24,0x7e,
			     0x7e,0x24,0x00,0x20,
			     0x70,0x70,0x20,0x00,
			     0x00,0x00,0x00,0x00,0x00 };
static char c_repo_2[16] = { 0x00,0x24,0x7e,
			     0x7e,0x24,0x00,0x00,
			     0x00,0x00,0x00,0x00,
			     0x00,0x00,0x00,0x00,0x00 };
static char c_repo_t[16] = { 0x00,0x20,0x70,
			     0x70,0x20,0x00,0x00,
			     0x00,0x00,0x00,0x00,
			     0x00,0x00,0x00,0x00,0x00 };
#else
static char c_repo[12] = { 0xff,0x81,0x81,
			     0x81,0x81,
			     0x81,0x81,0x81,
			     0x81,0x81,0x81,0xff };
static char c_repo_10[12] = { 0x00,0x24,
			     0x7e,0x24,0x24,
			     0x7e,0x7e,0x24,
			     0x24,0x7e,0x24,0x00 };
static char c_repo_8[12] = { 0x00,0x24,
			     0x7e,0x24,0x24,
			     0x7e,0x7e,0x24,
			     0x20,0x70,0x20,0x00 };
static char c_repo_6[12] = { 0x00,0x24,
			     0x7e,0x24,0x24,
			     0x7e,0x7e,0x24,
			     0x00,0x00,0x00,0x00 };
static char c_repo_4[12] = { 0x00,0x24,
			     0x7e,0x24,0x20,
			     0x70,0x70,0x20,
			     0x00,0x00,0x00,0x00 };
static char c_repo_2[12] = { 0x00,0x24,
			     0x7e,0x24,0x00,
			     0x00,0x00,0x00,
			     0x00,0x00,0x00,0x00 };
static char c_repo_t[12] = { 0x00,0x20,
			     0x70,0x20,0x00,
			     0x00,0x00,0x00,
			     0x00,0x00,0x00,0x00 };
#endif
	draw_it(c_repo,15);
	if(ee){
		if(ee > 10)
			draw_it(c_repo_10,14);
		else if(ee > 8)
			draw_it(c_repo_8,14);
		else if(ee > 6)
			draw_it(c_repo_6,14);
		else if(ee > 4)
			draw_it(c_repo_4,14);
		else if(ee > 2)
			draw_it(c_repo_2,14);
		else
			draw_it(c_repo_t,14);
	}
}

dr_fat()
{
#if SCREEN_MODE == _VRES16COLOR
static char c_fat[16] = { 0xff,0x81,0x81,
			     0x81,0x81,0x81,0x81,
			     0x81,0x81,0x81,0x81,
			     0x81,0x81,0x81,0x81,0xff };
static char c_fat_10[16] = { 0x00,0x24,0x7e,
			     0x7e,0x24,0x00,0x24,
			     0x7e,0x7e,0x24,0x00,
			     0x24,0x7e,0x7e,0x24,0x00 };
static char c_fat_8[16] = { 0x00,0x24,0x7e,
			     0x7e,0x24,0x00,0x24,
			     0x7e,0x7e,0x24,0x00,
			     0x20,0x70,0x70,0x20,0x00 };
static char c_fat_6[16] = { 0x00,0x24,0x7e,
			     0x7e,0x24,0x00,0x24,
			     0x7e,0x7e,0x24,0x00,
			     0x00,0x00,0x00,0x00,0x00 };
static char c_fat_4[16] = { 0x00,0x24,0x7e,
			     0x7e,0x24,0x00,0x20,
			     0x70,0x70,0x20,0x00,
			     0x00,0x00,0x00,0x00,0x00 };
static char c_fat_2[16] = { 0x00,0x24,0x7e,
			     0x7e,0x24,0x00,0x00,
			     0x00,0x00,0x00,0x00,
			     0x00,0x00,0x00,0x00,0x00 };
static char c_fat_t[16] = { 0x00,0x20,0x70,
			     0x70,0x20,0x00,0x00,
			     0x00,0x00,0x00,0x00,
			     0x00,0x00,0x00,0x00,0x00 };
#else
static char c_fat[12] = { 0xff,0x81,0x81,
			     0x81,0x81,
			     0x81,0x81,0x81,
			     0x81,0x81,0x81,0xff };
static char c_fat_10[12] = { 0x00,0x24,
			     0x7e,0x24,0x24,
			     0x7e,0x7e,0x24,
			     0x24,0x7e,0x24,0x00 };
static char c_fat_8[12] = { 0x00,0x24,
			     0x7e,0x24,0x24,
			     0x7e,0x7e,0x24,
			     0x20,0x70,0x20,0x00 };
static char c_fat_6[12] = { 0x00,0x24,
			     0x7e,0x24,0x24,
			     0x7e,0x7e,0x24,
			     0x00,0x00,0x00,0x00 };
static char c_fat_4[12] = { 0x00,0x24,
			     0x7e,0x24,0x20,
			     0x70,0x70,0x20,
			     0x00,0x00,0x00,0x00 };
static char c_fat_2[12] = { 0x00,0x24,
			     0x7e,0x24,0x00,
			     0x00,0x00,0x00,
			     0x00,0x00,0x00,0x00 };
static char c_fat_t[12] = { 0x00,0x20,
			     0x70,0x20,0x00,
			     0x00,0x00,0x00,
			     0x00,0x00,0x00,0x00 };
#endif
	draw_it(c_fat,1);
	if(ee){
		if(ee > 10)
			draw_it(c_fat_10,9);
		else if(ee > 8)
			draw_it(c_fat_8,9);
		else if(ee > 6)
			draw_it(c_fat_6,9);
		else if(ee > 4)
			draw_it(c_fat_4,9);
		else if(ee > 2)
			draw_it(c_fat_2,9);
		else
			draw_it(c_fat_t,9);
	}
}

draw_it(what,what_color)
register char *what;
register char what_color;
{
register char far *the_screen;
register int i;
int jmod;
register char dd,cd,cdlast;
static char smasks[8] = {0xff,0x7f,0x3f,0x1f,0x0f,0x07,0x03,0x01};

	the_screen = 0xA0000000L;
	the_screen = the_screen + ((long)yy*80) + (long)xx/8;
	cdlast = 0x00;

	jmod = xx % 8;

	outpw(0x3ce,0x0205);
	outpw(0x3ce,0x1803);

	if(jmod == 0){
		for(i=0;i<CHARY;i++){
			if(what[i] != 0x00){
				if(what[i] != cdlast){
					outpw(0x3ce,(what[i] << 8) | 0x08);
					cdlast = what[i];
				}
				dd = *the_screen;
				*the_screen = what_color;
			}
			the_screen += 80;
		}
	}else{
		for(i=0;i<CHARY;i++){
			cd = (what[i] >> jmod)&smasks[jmod];
			if(cd != 0x00){
				if(cd != cdlast){
					outpw(0x3ce,(cd << 8)|0x08);
					cdlast = cd;
				}
				dd = *the_screen;
				*the_screen = what_color;
			}
			the_screen+=80;
		}
		the_screen -= (CHARY * 80);
		the_screen++;
		for(i=0;i<CHARY;i++){
			cd = (what[i] << (8-jmod))&(~smasks[jmod]);
			if(cd != 0x00){
				if(cd != cdlast){
					outpw(0x3ce,(cd << 8)|0x08);
					cdlast = cd;
				}
				dd = *the_screen;
				*the_screen = what_color;
			}
			the_screen += 80;
		}
	}
	outpw(0x3ce,0xff08);
	outpw(0x3ce,0x0005);
	outpw(0x3ce,0x0003);
}

